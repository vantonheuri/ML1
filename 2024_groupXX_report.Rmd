---
title: |
  ![](LogoZugEstates.png){width=4in}   
  Real Estate Pricing
author: "Victor Anton, Rodrigo Gonzalez & Carlos Leon"
date: "Machine Learning 1 - 05 June 2024"
output: 
  prettydoc::html_pretty:
    theme: hpstr
    highlight: github
    #highlight: tango
    toc: yes
    toc_depth: 1
    # toc_float: yes
    number_sections: yes
    #code_folding: hide
  pdf_document:
    toc: yes
    toc_depth: 3
  # html_document:
  #   toc: yes
  #   toc_depth: 2
  #   toc_float: true
  #   number_sections: yes
  #   code_folding: hide
  #   theme: cerulean
  #   highlight: tango
knit:
  citations: yes
---

```{r setup, include = FALSE, warning = FALSE}
library(knitr)
opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  warning = FALSE,
  message = FALSE)
```

# Introduction

Zug Estates focuses on developing, managing, and marketing properties in the Zug region, Switzerland. They prioritize centrally located sites for sustainable, multi-use development. Their portfolio is concentrated in Zug and Risch Rotkreuz, featuring a mix of residential, office, retail, hotel, and service spaces. The company aims for long-term property retention and development, driving value creation through sustainable designs and active management 

Zug Estates, a major real estate player in Zug, Switzerland, might be looking to invest in other parts of the country for several reasons. Here's a comprehensive breakdown: 

* __Risk Reduction:__ 
The real estate market can be volatile. By spreading their investments across different cantons (Swiss states), Zug Estates reduces the risk associated with a downturn in Zug's market. They might target areas with strong growth potential or a different property mix to complement their Zug portfolio. This diversification provides a buffer and ensures a more stable income stream. 

* __Saturated Market:__ 
Perhaps the Zug market is saturated, meaning there are limited opportunities for profitable investments. Expanding to other areas allows Zug Estates to tap into new markets with higher potential returns. They might find regions with a greater need for the kind of development they specialize in, offering exciting growth possibilities. 

* __Connecting the Landscape:__ 
Zug Estates' investments might have a strategic element beyond just individual properties. They could be acquiring properties near transportation hubs or in developing commercial centers. This could be a way to connect different areas of Switzerland through their investments, potentially influencing the overall development landscape. 

* __Reputation and Knowledge:__ 
Over time, Zug Estates has likely built a strong reputation for high-quality development and property management within Zug. Expanding to other cantons allows them to leverage this reputation. They can attract partnerships with local developers or win contracts for projects in new areas based on their proven track record. Essentially, they bring their successful model to other parts of Switzerland. 

* __Capitalizing on Demand:__ 
Zug Estates might be strategically responding to broader market trends across Switzerland. Perhaps there's a growing demand for specific property types, like student housing or retirement communities, in certain regions. By investing in these areas, they can capitalize on these trends and meet those demands, ensuring their portfolio remains relevant and profitable. .

## Dataset "Homegate..."

... Rodrigo ...

## Motivation and Goal

... Rodrigo ...

## Project Structure

... Rodrigo ...

## Navigating the Report: Understanding the Hidden R Code

This report is based on R code that was used to explore, train, and test various models on the data. To maintain a clean and accessible format, much of this code is hidden within the document. However, upon request, the code can be made visible for thorough review. This feature not only helps ensure the reproducibility of our analysis but also facilitates ease of reading.

# Data Preperation

Before proceeding to the exploratory graphical analysis, this chapter provides a brief overview of how the dataset was loaded and prepared.

## Libraries

In this report the following libraries are used.

<details>

<summary>*Click to see all libraries*</summary>

```{r libraries, class.source = "fold-show"}
# used libraries
library(readr)
library(ggplot2)
library(stringr)
library(dplyr)
library(readxl)
library(openxlsx)
library(lubridate)
library(readxl)
library(neuralnet)
library(caret)
library(e1071)
```

</details> 

<br>


# Exploratory Graphical Analysis

This chapter delves into an in-depth exploration of the dataset to gain a comprehensive understanding of the underlying data, with a particular focus on the key variable of interest: attrition. As highlighted in the introduction, our primary objective in this section is to examine attrition closely and to analyze its relationships with other variables in the dataset.

A critical observation from our initial analysis is the notable imbalance in the response variable. The data reveals that a significant majority of the workforce, amounting to over 80%, have not experienced attrition. Specifically, out of the total number of employees in the dataset, 1233 remain employed, while 237 have left the company (marked as 'attrition = yes'). This disproportionate representation poses a potential challenge in the context of predictive modeling. Models developed under these conditions may inherently exhibit a bias towards the majority class, in this case, the employees who have stayed.


```{r, echo=FALSE}
df_total <- read_excel("data/data_cleaned/data_total.xlsx")
colnames(df_total)
```

### Properties per Canton

Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.

```{r Properties per Canton, echo=FALSE, warning = FALSE}
# Counting properties per Canton and arranging them from highest to lowest
properties_per_canton <- df_total %>%
  group_by(Canton) %>%
  summarise(Count = n()) %>%
  arrange(desc(Count)) # Arrange in descending order of count

# Creating the vertical bar chart with smaller data labels
ggplot(properties_per_canton, aes(x = reorder(Canton, -Count), y = Count)) +
  geom_bar(stat = "identity", fill = "skyblue", color = "black") +
  geom_text(aes(label = Count), vjust = -0.5, color = "black", size = 2.2) + # Data labels above bars
  labs(title = "Properties per Canton", x = "Canton", y = "Count of Properties") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1), # Rotate x-axis labels for better readability
        plot.title = element_text(hjust = 0.5))
```

### Average Rental Price per Canton

Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.

```{r Average Rental Price per Canton, echo=FALSE, warning = FALSE}
canton_order <- df_total %>%
  group_by(Canton) %>%
  summarise(Average_Price_Gross = mean(Price_Gross, na.rm = TRUE)) %>%
  arrange(desc(Average_Price_Gross)) %>%
  .$Canton

# Adjust the factor levels of Canton based on the calculated order
df_total$Canton <- factor(df_total$Canton, levels = canton_order)

# Plot with cantons ordered by average rental price
ggplot(df_total, aes(x = Canton, y = Price_Gross)) +
  stat_summary(fun = "mean", geom = "bar", fill = "skyblue", color = "black") +
  labs(title = "Average Rental Price per Canton", x = "Canton", y = "Average Rental Price (CHF)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

### Differences in rental prices between different customer segment

Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.

```{r Differences in rental prices between different customer segment, echo=FALSE, warning = FALSE}
  # - Are there differences in rental prices between different customer segments?
  # Option 1
  ggplot(df_total, aes(x = Customer_Segment, y = Price_Gross, fill = Customer_Segment)) +
  geom_boxplot(outlier.size = 1.5, alpha = 0.7) + 
  scale_fill_brewer(palette = "Pastel1") + 
  coord_cartesian(ylim = c(0, quantile(df_total$Price_Gross, 0.95, na.rm = TRUE))) + 
  labs(title = "Rental Prices by Customer Segment", x = "Customer Segment", y = "Gross Price (CHF)") +
  theme_minimal() +
  theme(legend.position = "none") 

# Option 2
ggplot(df_total, aes(x = Customer_Segment, y = Price_Gross)) +
  geom_boxplot(outlier.size = 1, aes(fill = Customer_Segment)) + 
  scale_y_log10(limits = c(100, NA)) + 
  scale_fill_brewer(palette = "Pastel1", guide = FALSE) + 
  labs(title = "Rental Prices by Customer Segment", x = "Customer Segment", y = "Gross Price (CHF)") +
  theme_minimal() +
  theme(legend.position = "none")
```

### TITULO

Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.

```{r Correlation Between Property Size and Rental Price, echo=FALSE, warning = FALSE}
# - Is there a correlation between the size of the property (in m2) and the rental price?
  
# We sleect the Top Ten Cantons
top_10_cantons <- c("ZH", "VD", "AG", "SG", "BE", "TI", "LU", "TG", "BS", "ZG")
top_5_cantons <- c("ZH", "VD", "AG", "SG", "BE")

# Filter the dataset to include only the top cantons
df_top_10_cantons <- df_total %>%
  filter(Canton %in% top_10_cantons) %>%
  filter(Price_Gross <= 500000, Size_m2 <= 300) # Apply filters for Price_Gross and Size_m2

# Filter the dataset to include only the top cantons
df_top_5_cantons <- df_total %>%
  filter(Canton %in% top_5_cantons) %>%
  filter(Price_Gross <= 500000, Size_m2 <= 300) # Apply filters for Price_Gross and Size_m2

# Create a manual pastel color palette
pastel_colors <- c("ZH" = "#bdb2ff",  # Pastel blue
                   "VD" = "#ffd6a5",  # Lighter pastel blue
                   "AG" = "#b4f8c8",  # Pastel cyan
                   "SG" = "#ade8f4",  # Lighter pastel cyan
                   "BE" = "#ffafcc",  # Pastel red
                   "TI" = "#bde0fe",  # Pastel orange
                   "LU" = "#90e0ef",  # Pastel green
                   "TG" = "#a0c4ff",  # Another shade of pastel blue
                   "BS" = "#a1c9f4",  # Pastel purple
                   "ZG" = "#ffc6ff") # Pastel pink

# Scatter Plot TOP 5
ggplot(df_top_5_cantons, aes(x = Size_m2, y = Price_Gross)) +
  geom_point(aes(color = Canton), size = 0.8, alpha = 0.8) + # Smaller points with size 1
  scale_color_manual(values = pastel_colors) +
  geom_smooth(method = "lm", color = "darkblue", size = 0.5, se = FALSE) +
  labs(title = "Correlation Between Property Size and Rental Price", x = "Size (m²)", y = "Gross Price (CHF)") +
  theme_minimal() +
  scale_y_log10(labels = scales::comma) # Apply logarithmic scale to y-axis
```

### Distribution of Property Size

Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.

```{r Distribution of Property Size, echo=FALSE, warning = FALSE}
# Histogram for Size_m2
ggplot(df_total, aes(x = Size_m2)) +
  geom_histogram(bins = 30, fill = "skyblue", color = "black") +
  labs(title = "Distribution of Property Size", x = "Size (m²)", y = "Frequency") +
  theme_minimal()
```

### Distribution of Number of Rooms

Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.

```{r Distribution of Number of Rooms, echo=FALSE, warning = FALSE}
# Histogram for Nr_rooms
ggplot(df_total, aes(x = Nr_rooms)) +
  geom_histogram(bins = 30, fill = "skyblue", color = "black") +
  labs(title = "Distribution of Number of Rooms", x = "Number of Rooms", y = "Frequency") +
  theme_minimal()
```

_Interpreta el grafico_

### Effect of Number of Rooms on Rental Price

Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.

```{r Effect of Number of Rooms on Rental Price, echo=FALSE, warning = FALSE}
# - How does the number of rooms affect the rental price?

# Apply filters to remove extreme prices for better visualization
  df_filtered <- df_total %>%
  filter(Price_Gross <= 500000) %>%
  mutate(Nr_rooms = as.factor(Nr_rooms)) # Treat number of rooms as a factor

# Create the scatter plot without differentiating by canton
ggplot(df_filtered, aes(x = Nr_rooms, y = Price_Gross)) +
  geom_point(alpha = 0.6, size = 1, color = "skyblue") +
  labs(title = "Effect of Number of Rooms on Rental Price", x = "Number of Rooms", y = "Gross Price (CHF)") +
  theme_minimal() +
  scale_y_log10() # Apply logarithmic scale to y-axis
```


# Linear Model

Our initial strategy to predict attrition involved utilizing a linear model. However, since attrition is inherently binary, employing a linear model for prediction is not optimal. Recognizing the close relationship between attrition and retention, we turn our attention to the latter. While attrition analysis the reasons behind employees' departures, exploring retention allows us to comprehend the reasons they stay and the elements that ensure their sustained allegiance. By redirecting our focus to retention, we seek to acquire a more rounded perspective of our workforce. 

## Linear Regression Analysis for "Years at Company"

We have chosen "Years at Company" as our response variable to predict the tenure of employees within the company. This will provide us with valuable insights into retention factors and help us better understand the elements that influence an employee's longevity with the company.

### Practical Implications

Based on the comparison of predictors for employee attrition and retention, here are some practical implications (as first ideas) that can be drawn to enhance employee engagement, reduce turnover, and improve retention:

- Enhancing Job Satisfaction and Involvement: Regular feedback and personalized development opportunities can increase job satisfaction, directly impacting retention. Addressing factors that affect job involvement, such as role clarity and recognition, is crucial.
- Work-Life Balance: Managing overtime and offering flexible work arrangements can significantly reduce burnout and attrition, particularly for those with longer commutes. Tailoring benefits to diverse life situations, like family needs or social engagement for single employees, acknowledges the varied personal lives of the workforce.
- Training and Career Development: Focusing on continuous learning and clear career paths can engage employees, reducing the likelihood of job-hopping and increasing tenure.

## Outlook

We would like to highlight our top four recommendations for improvements in future endeavors related to this project and more broadly in the field of employee attrition.

### Data Quality and Amount

Future studies could benefit from investigating ensemble methods, which merge the advantages of various models to boost overall efficacy. We suggest that a larger dataset might enhance the performance of specific models like neural networks. Furthermore, gathering additional predictive variables could facilitate the training of more sophisticated models. 

The primary focus of our project was centered on identifying general predictors of attrition. This objective shaped our analytical approach and the methodologies we employed, and provided a foundation for understanding the key predictors. An extension of our analysis would be to change the focus and predict the probabilities of employee attrition, rather than solely classifying outcomes. This approach would enable us to personalize interventions more effectively, tailoring strategies to the specific likelihood of an employee's departure. 

### Enhanced Validation of Models

Due to the time constraints and scope of this project, we couldn't conduct extensive validation and testing for all models. Implementing more techniques such as cross-validation and regularization in the training phase would be necessary to enhance the overall quality and performance of the developed models. Moreover, testing interactions was at short-cut in this project. In 

### Model Complexity vs. Performance

The study underscored the delicate balance between model complexity and performance. Although more sophisticated models, as seen in the GAM and SVM sections, are adept at identifying complex patterns, they don't always guarantee the most accurate predictions in every situation, particularly regarding specificity. When developing a model for a company, it's essential to clearly articulate the model's intended purpose and application to determine the most appropriate solution.

### Data Privacy and Ethics

While we have pointed out that various stakeholders can gain from these models, it's crucial to note that the personal data used here, such as marital status, is highly sensitive in non-fictional datasets. Companies should thoughtfully consider which data points to utilize about their employees. Relying on certain predictors can potentially introduce significant bias, particularly against underrepresented groups within the organization.

## Personal Learnings

This project was a great opportunity for us to learn about machine learning and develop our skills. We really enjoyed experimenting with different models, which is why our report is so long - we had a lot of work to cut down.

Our models are of solid quality, but we didn't get to explore every detail or use all the methods perfectly. For example, our early graphical analysis could be improved by using methods better suited to different types of data than just correlation coefficients, or validation of different models is not fully implemented (CSV). The neural network component, in particular, posed significant challenges. Our results here were not as robust as we had hoped, possibly due to limitations in the amount of data available. This experience highlighted the importance of having a substantial dataset for neural network models to truly excel.

An important lesson we learned was the need to establish common measures in advance for effective model comparison. This ensures that a meaningful comparison can be made using the measures. We also learned the importance of considering the data set when choosing metrics.  In our case, relying solely on accuracy as a metric wasn't appropriate due to the unbalanced nature of the dataset. 

It's important to note that ChatGPT was a valuable resource when we were faced with difficult debugging problems. However, we made a point of understanding, modifying and correcting the suggested code independently to ensure that our final work was truly our own and not a mere replication of the solutions provided.

In the end, we're happy with the end result of our report, and even happier with how much we learned along the way.

# References

[^ref1]: Homepage - ZugEstates. (s. f.). Zugestates. <https://zugestates.ch/>

[^ref2]: Homepage - ZugEstates. (s. f.). Zugestates. <https://zugestates.ch/>

[^ref3]: Homepage - ZugEstates. (s. f.). Zugestates. <https://zugestates.ch/>

[^ref4]: Homepage - ZugEstates. (s. f.). Zugestates. <https://zugestates.ch/>

[^ref5]: Homepage - ZugEstates. (s. f.). Zugestates. <https://zugestates.ch/>
